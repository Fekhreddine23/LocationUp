<!-- offer-management.html -->
<div class="offer-management-container">
  <app-breadcrumbs [items]="breadcrumbItems"></app-breadcrumbs>

  <div class="page-header">
    <div class="header-content">
      <h1>Gestion des Offres</h1>
      <p>Cr√©ez et g√©rez les offres de mobilit√© disponibles</p>
    </div>
    <button (click)="goBackToDashboard()" class="back-btn">
      ‚Üê Retour au Dashboard
    </button>
  </div>

  <!-- Messages -->
  <div *ngIf="successMessage" class="alert alert-success">
    ‚úÖ {{ successMessage }}
  </div>
  <div *ngIf="errorMessage" class="alert alert-error">
    ‚ùå {{ errorMessage }}
  </div>

  <!-- Barre d'actions -->
  <div class="actions-section">
    <button (click)="createOffer()" class="btn-primary">
      ‚ûï Nouvelle Offre
    </button>
  </div>

  <!-- Barre de recherche et filtres -->
  <div class="filters-section">
    <div class="search-bar">
      <input 
        type="text" 
        [(ngModel)]="searchQuery" 
        (input)="searchOffers()"
        placeholder="Rechercher une offre..."
        class="search-input">
      <button (click)="searchOffers()" class="search-btn">
        üîç Rechercher
      </button>
    </div>

    <div class="filter-controls">
      <select [(ngModel)]="statusFilter" (change)="applyFilters()" class="filter-select">
        <option value="ALL">Tous les statuts</option>
        <option value="ACTIVE">Actives</option>
        <option value="INACTIVE">Inactives</option>
        <option value="EXPIRED">Expir√©es</option>
      </select>

      <input 
        type="text" 
        [(ngModel)]="locationFilter" 
        (input)="applyFilters()"
        placeholder="Lieu..."
        class="filter-input">

      <button (click)="loadOffers()" class="refresh-btn">
        üîÑ Actualiser
      </button>
    </div>
  </div>

  <!-- Tableau des offres -->
  <div class="offers-table-container">
    <div class="table-header">
      <div class="table-stats">
        {{ totalElements }} offre(s) trouv√©e(s)
      </div>
    </div>

    <div *ngIf="isLoading" class="loading-state">
      Chargement des offres...
    </div>

    <div *ngIf="!isLoading && filteredOffers.length === 0" class="empty-state">
      Aucune offre trouv√©e
    </div>

    <div *ngIf="!isLoading && filteredOffers.length > 0" class="offers-grid">
      <div *ngFor="let offer of filteredOffers" class="offer-card">
        <div class="offer-header">
          <h3 class="offer-title">{{ offer.mobilityService }}</h3>
          <span [class]="'status-badge ' + getStatusClass(offer.status)">
            {{ getStatusText(offer.status) }}
          </span>
        </div>
        
        <div class="offer-content">
          <div class="offer-info">
            <div class="info-item">
              <span class="info-label">üìç D√©part:</span>
              <span class="info-value">{{ offer.pickupLocation }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">üéØ Retour:</span>
              <span class="info-value">{{ offer.returnLocation }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">üìÖ Date:</span>
              <span class="info-value">{{ formatDate(offer.pickupDatetime) }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">üí∞ Prix:</span>
              <span class="info-value price">{{ formatCurrency(offer.price) }}</span>
            </div>
          </div>
          
          <div *ngIf="offer.description" class="offer-description">
            {{ offer.description }}
          </div>
        </div>

        <div class="offer-actions">
          <button (click)="editOffer(offer)" class="btn-edit" title="Modifier">
            ‚úèÔ∏è Modifier
          </button>
          <button 
            (click)="toggleOfferStatus(offer)" 
            [class]="offer.status === 'ACTIVE' ? 'btn-deactivate' : 'btn-activate'"
            [title]="offer.status === 'ACTIVE' ? 'D√©sactiver' : 'Activer'">
            {{ offer.status === 'ACTIVE' ? '‚è∏Ô∏è D√©sactiver' : '‚ñ∂Ô∏è Activer' }}
          </button>
          <button (click)="confirmDelete(offer)" class="btn-delete" title="Supprimer">
            üóëÔ∏è Supprimer
          </button>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <div *ngIf="totalPages > 1" class="pagination">
      <button 
        (click)="goToPage(currentPage - 1)" 
        [disabled]="currentPage === 0"
        class="pagination-btn">
        ‚Üê Pr√©c√©dent
      </button>
      
      <span class="pagination-info">
        Page {{ currentPage + 1 }} sur {{ totalPages }}
      </span>
      
      <button 
        (click)="goToPage(currentPage + 1)" 
        [disabled]="currentPage >= totalPages - 1"
        class="pagination-btn">
        Suivant ‚Üí
      </button>
    </div>
  </div>

  <!-- Modal de cr√©ation -->
  <div *ngIf="isCreateModalOpen" class="modal-overlay">
    <div class="modal large-modal">
      <div class="modal-header">
        <h3>Cr√©er une nouvelle offre</h3>
        <button (click)="isCreateModalOpen = false" class="close-btn">√ó</button>
      </div>
      <div class="modal-content">
        <div class="form-grid">
          <div class="form-group">
            <label>Lieu de d√©part *</label>
            <input 
              type="text" 
              [(ngModel)]="newOffer.pickupLocation" 
              class="form-input"
              placeholder="Ex: Paris Centre">
          </div>
          <div class="form-group">
            <label>Lieu de retour *</label>
            <input 
              type="text" 
              [(ngModel)]="newOffer.returnLocation" 
              class="form-input"
              placeholder="Ex: Paris Centre">
          </div>
          <div class="form-group">
            <label>Service de mobilit√© *</label>
            <select [(ngModel)]="newOffer.mobilityService" class="form-input">
              <option value="">S√©lectionnez un service</option>
              <option value="Voiture √©lectrique">Voiture √©lectrique</option>
              <option value="Scooter √©lectrique">Scooter √©lectrique</option>
              <option value="V√©lo √©lectrique">V√©lo √©lectrique</option>
              <option value="Voiture thermique">Voiture thermique</option>
            </select>
          </div>
          <div class="form-group">
            <label>Date et heure de pickup *</label>
            <input 
              type="datetime-local" 
              [(ngModel)]="newOffer.pickupDatetime" 
              class="form-input">
          </div>
          <div class="form-group">
            <label>Prix (‚Ç¨) *</label>
            <input 
              type="number" 
              [(ngModel)]="newOffer.price" 
              class="form-input"
              min="0"
              step="0.01">
          </div>
          <div class="form-group full-width">
            <label>Description</label>
            <textarea 
              [(ngModel)]="newOffer.description" 
              class="form-textarea"
              placeholder="Description de l'offre..."
              rows="3"></textarea>
          </div>
        </div>
      </div>
      <div class="modal-actions">
        <button (click)="isCreateModalOpen = false" class="btn-cancel">
          Annuler
        </button>
        <button 
          (click)="submitNewOffer()" 
          [disabled]="!isValidOffer()"
          class="btn-confirm">
          Cr√©er l'offre
        </button>
      </div>
    </div>
  </div>

  <!-- Modal d'√©dition -->
  <div *ngIf="isEditModalOpen" class="modal-overlay">
    <div class="modal large-modal">
      <div class="modal-header">
        <h3>Modifier l'offre</h3>
        <button (click)="isEditModalOpen = false" class="close-btn">√ó</button>
      </div>
      <div class="modal-content" *ngIf="selectedOffer">
        <div class="form-grid">
          <div class="form-group">
            <label>Lieu de d√©part</label>
            <input 
              type="text" 
              [(ngModel)]="selectedOffer.pickupLocation" 
              class="form-input">
          </div>
          <div class="form-group">
            <label>Lieu de retour</label>
            <input 
              type="text" 
              [(ngModel)]="selectedOffer.returnLocation" 
              class="form-input">
          </div>
          <div class="form-group">
            <label>Service de mobilit√©</label>
            <select [(ngModel)]="selectedOffer.mobilityService" class="form-input">
              <option value="Voiture √©lectrique">Voiture √©lectrique</option>
              <option value="Scooter √©lectrique">Scooter √©lectrique</option>
              <option value="V√©lo √©lectrique">V√©lo √©lectrique</option>
              <option value="Voiture thermique">Voiture thermique</option>
            </select>
          </div>
          <div class="form-group">
            <label>Date et heure</label>
            <input 
              type="datetime-local" 
              [value]="selectedOffer.pickupDatetime | date:'yyyy-MM-ddTHH:mm'"
              (input)="selectedOffer.pickupDatetime = $event.target.value"
              class="form-input">
          </div>
          <div class="form-group">
            <label>Prix (‚Ç¨)</label>
            <input 
              type="number" 
              [(ngModel)]="selectedOffer.price" 
              class="form-input"
              min="0"
              step="0.01">
          </div>
          <div class="form-group full-width">
            <label>Description</label>
            <textarea 
              [(ngModel)]="selectedOffer.description" 
              class="form-textarea"
              rows="3"></textarea>
          </div>
        </div>
      </div>
      <div class="modal-actions">
        <button (click)="isEditModalOpen = false" class="btn-cancel">
          Annuler
        </button>
        <button (click)="updateOffer()" class="btn-confirm">
          Enregistrer
        </button>
      </div>
    </div>
  </div>

  <!-- Modal de confirmation de suppression -->
  <div *ngIf="isDeleteModalOpen" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h3>Confirmer la suppression</h3>
        <button (click)="isDeleteModalOpen = false" class="close-btn">√ó</button>
      </div>
      <div class="modal-content" *ngIf="selectedOffer">
        <p>√ätes-vous s√ªr de vouloir supprimer l'offre <strong>{{ selectedOffer.mobilityService }}</strong> ?</p>
        <p class="warning-text">Cette action est irr√©versible.</p>
      </div>
      <div class="modal-actions">
        <button (click)="isDeleteModalOpen = false" class="btn-cancel">
          Annuler
        </button>
        <button (click)="deleteOffer()" class="btn-danger">
          Supprimer
        </button>
      </div>
    </div>
  </div>
</div>
