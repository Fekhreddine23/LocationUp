<header class="header">
  <ng-container *ngIf="authResolved; else headerSkeleton">
  <nav class="nav">
    <div class="logo">
      <a routerLink="/" class="brand">
        <span>LocationUp</span>
        <span class="brand-badge" *appHasRole="'ROLE_ADMIN'">PRO</span>
      </a>
      <small class="brand-subtitle" *appHasRole="'ROLE_ADMIN'">Espace op√©rateur</small>
    </div>
    <button 
      type="button" 
      class="mobile-menu-toggle" 
      (click)="toggleMobileMenu()" 
      [attr.aria-expanded]="isMobileMenuOpen"
      aria-label="Menu principal">
      <span></span>
      <span></span>
      <span></span>
    </button>

    <div class="nav-links" [class.open]="isMobileMenuOpen">
      <a routerLink="/" class="nav-link" (click)="closeMobileMenu()">Accueil</a>

      <ng-container *ngIf="!isLoggedIn; else userMenu">
        <a routerLink="/login" class="nav-link" (click)="closeMobileMenu()">Connexion</a>
        <a routerLink="/register" class="nav-link button" (click)="closeMobileMenu()">Inscription</a>
      </ng-container>

      <ng-template #userMenu>
        <a *ngIf="!isAdmin" [routerLink]="dashboardRoute" class="nav-link" (click)="closeMobileMenu()">
          Dashboard
        </a>
        <a *ngIf="!isAdmin" [routerLink]="offersRoute" class="nav-link" (click)="closeMobileMenu()">Offres</a>
        <a *ngIf="!isAdmin" [routerLink]="favoritesRoute" class="nav-link" (click)="closeMobileMenu()">Favoris</a>
        <a *ngIf="!isAdmin" [routerLink]="bookingsRoute" class="nav-link" (click)="closeMobileMenu()">R√©servations</a>
        <a *ngIf="!isAdmin" routerLink="/support" class="nav-link" (click)="closeMobileMenu()">Support</a>

        <section class="admin-quick-links" *appHasRole="'ROLE_ADMIN'">
          <button class="admin-chip" type="button" (click)="toggleAdminLinks()">
            <span class="chip-icon">üõ†Ô∏è</span>
            <span class="label">Espace admin</span>
            <span class="chevron" [class.open]="adminLinksOpen">‚ñ∏</span>
          </button>
          <div class="admin-links" [class.open]="adminLinksOpen">
            <button type="button"
                    class="admin-link"
                    *ngFor="let link of adminNavLinks"
                    (click)="navigateTo(link.route)">
              <span class="icon">{{ link.icon }}</span>
              <span>{{ link.label }}</span>
            </button>
          </div>
        </section>

        <!-- ‚úÖ INT√âGRATION DE LA NOTIFICATION -->
        <app-notification></app-notification>

        <div class="user-menu">
          <button class="user-btn" (click)="toggleMenu()">
            üë§ {{ currentUser?.username }}
          </button>

          <div class="dropdown-menu" *ngIf="isMenuOpen">
            <a routerLink="/profile" class="dropdown-item">Mon Profil</a>
            <button (click)="logout()" class="dropdown-item logout">D√©connexion</button>
          </div>
        </div>

         <!-- AJOUT DU BOUTON DE BASCULEMENT DU TH√àME -->
        <button class="theme-toggle" (click)="toggleTheme()"
          [title]="isDarkMode ? 'Passer en mode clair' : 'Passer en mode sombre'">
          <span class="theme-icon" [class.dark]="isDarkMode">
            {{ isDarkMode ? 'üåô' : '‚òÄÔ∏è' }}
          </span>
        </button>
      </ng-template>
    </div>
  </nav>
  </ng-container>
  <ng-template #headerSkeleton>
    <div class="header-skeleton" aria-live="polite">
      <div class="skeleton-logo app-skeleton-line"></div>
      <div class="skeleton-pill-row">
        <div class="app-skeleton-pill" *ngFor="let _ of skeletonPills"></div>
      </div>
    </div>
  </ng-template>
</header>
