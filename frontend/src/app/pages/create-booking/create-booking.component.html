<div class="create-booking-container">
  <div class="booking-form-card">
    <h2>Nouvelle R√©servation</h2>

    <!-- Messages -->
    <div *ngIf="successMessage" class="alert alert-success">
      ‚úÖ {{ successMessage }}
      <p>Redirection automatique dans 2 secondes...</p>
    </div>

    <div *ngIf="errorMessage" class="alert alert-error">
      ‚ùå {{ errorMessage }}
    </div>

    <!-- Chargement des offres -->
    <div *ngIf="isLoadingOffers" class="loading-offers">
      <div class="spinner"></div>
      <p>Chargement des offres disponibles...</p>
    </div>

    <form (ngSubmit)="onSubmit()" #bookingForm="ngForm" *ngIf="!successMessage && !isLoadingOffers">
      
      <!-- S√©lection de l'offre -->
      <div class="form-group">
        <label for="offerSelect">Choisir une offre *</label>
        
        <!-- Offre pr√©s√©lectionn√©e depuis l'URL -->
        <div *ngIf="bookingRequest.offerId > 0 && preselectedOffer" class="preselected-offer">
          <div class="preselected-badge">
            üéØ Offre pr√©s√©lectionn√©e
          </div>
          <div class="offer-card selected">
            <h4>{{ preselectedOffer.description }}</h4>
            <div class="offer-details">
              <span class="price">{{ preselectedOffer.price | currency:'EUR' }}</span>
              <span class="date">Disponible le {{ preselectedOffer.pickupDatetime | date:'dd/MM/yyyy HH:mm' }}</span>
            </div>
            <small>ID: {{ preselectedOffer.offerId }}</small>
          </div>
        </div>

        <!-- Liste d√©roulante des offres -->
        <select 
          *ngIf="!bookingRequest.offerId || !preselectedOffer"
          id="offerSelect"
          name="offerId"
          [(ngModel)]="bookingRequest.offerId"
          required
          class="form-control"
          [disabled]="isLoading">
          <option value="">-- S√©lectionnez une offre --</option>
          <option 
            *ngFor="let offer of offers" 
            [value]="offer.offerId"
            [disabled]="!isOfferAvailable(offer)">
            {{ offer.description }} - {{ offer.price | currency:'EUR' }}
            {{ !isOfferAvailable(offer) ? '(Indisponible)' : '' }}
          </option>
        </select>

        <!-- Liste visuelle des offres (alternative) -->
        <div *ngIf="offers.length > 0 && (!bookingRequest.offerId || !preselectedOffer)" class="offers-grid">
          <div 
            *ngFor="let offer of offers" 
            class="offer-card" 
            [class.selected]="bookingRequest.offerId === offer.offerId"
            [class.unavailable]="!isOfferAvailable(offer)"
            (click)="selectOffer(offer)">
            
            <div class="offer-header">
              <h4>{{ offer.description }}</h4>
              <span class="price-tag">{{ offer.price | currency:'EUR' }}</span>
            </div>
            
            <div class="offer-details">
              <p class="pickup-time">
                üìÖ {{ offer.pickupDatetime | date:'dd/MM/yyyy HH:mm' }}
              </p>
              <p class="offer-id">
                ID: {{ offer.offerId }}
              </p>
            </div>

            <div class="offer-actions">
              <span *ngIf="!isOfferAvailable(offer)" class="unavailable-badge">
                Indisponible
              </span>
              <span *ngIf="isOfferAvailable(offer) && bookingRequest.offerId === offer.offerId" class="selected-badge">
                ‚úÖ S√©lectionn√©e
              </span>
              <button 
                *ngIf="isOfferAvailable(offer) && bookingRequest.offerId !== offer.offerId"
                type="button" 
                class="btn-select"
                (click)="selectOffer(offer); $event.stopPropagation()">
                Choisir
              </button>
            </div>
          </div>
        </div>

        <small class="form-help">
          {{ offers.length }} offre(s) disponible(s)
        </small>
      </div>

      <!-- Aper√ßu de l'offre s√©lectionn√©e -->
      <div *ngIf="getSelectedOffer()" class="selected-offer-preview">
        <h4>üéØ Offre s√©lectionn√©e :</h4>
        <div class="offer-preview-card">
          <h5>{{ getSelectedOffer()!.description }}</h5>
          <div class="preview-details">
            <p><strong>Prix :</strong> {{ getSelectedOffer()!.price | currency:'EUR' }}</p>
            <p><strong>Disponible le :</strong> {{ getSelectedOffer()!.pickupDatetime | date:'dd/MM/yyyy HH:mm' }}</p>
            <p><strong>ID offre :</strong> {{ getSelectedOffer()!.offerId }}</p>
          </div>
        </div>
      </div>

      <!-- Date et heure de r√©servation -->
      <div class="form-group">
        <label for="reservationDate">Date et heure de r√©servation *</label>
        <input 
          type="datetime-local"
          id="reservationDate"
          name="reservationDate"
          [(ngModel)]="bookingRequest.reservationDate"
          required
          class="form-control"
          [disabled]="isLoading"
          [min]="getMinDate()"
          [max]="getMaxDate()">
        <small class="form-help">
          S√©lectionnez une date entre aujourd'hui et {{ getMaxDate() | date:'dd/MM/yyyy HH:mm' }}
        </small>
      </div>

      <!-- Informations de l'utilisateur -->
      <div class="form-group" *ngIf="bookingRequest.userId > 0">
        <label>Utilisateur connect√©</label>
        <div class="user-info">
          <strong>ID:</strong> {{ bookingRequest.userId }}
          <span *ngIf="currentUser">({{ currentUser.username }})</span>
        </div>
        <small class="form-help">Votre identifiant utilisateur</small>
      </div>

      <!-- Aper√ßu final de la r√©servation -->
      <div *ngIf="bookingRequest.reservationDate && getSelectedOffer()" class="preview-section">
        <h4>üìã Aper√ßu de la r√©servation :</h4>
        <div class="preview-details final-preview">
          <div class="preview-item">
            <strong>Offre :</strong> {{ getSelectedOffer()!.description }}
          </div>
          <div class="preview-item">
            <strong>Prix :</strong> {{ getSelectedOffer()!.price | currency:'EUR' }}
          </div>
          <div class="preview-item">
            <strong>Date de r√©servation :</strong> {{ bookingRequest.reservationDate | date:'dd/MM/yyyy HH:mm' }}
          </div>
          <div class="preview-item">
            <strong>Utilisateur :</strong> ID {{ bookingRequest.userId }}
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="form-actions">
        <button 
          type="button" 
          class="btn btn-secondary"
          (click)="onCancel()"
          [disabled]="isLoading">
          Annuler
        </button>
        
        <button 
          type="submit" 
          class="btn btn-primary"
          [disabled]="!bookingForm.form.valid || isLoading || !getSelectedOffer()">
          {{ isLoading ? '‚è≥ Cr√©ation en cours...' : '‚úÖ Confirmer la r√©servation' }}
        </button>
      </div>
    </form>

    <div *ngIf="successMessage" class="success-actions">
      <button 
        type="button" 
        class="btn btn-primary"
        (click)="navigateToBookings()">
        üìã Voir mes r√©servations
      </button>
    </div>
  </div>
</div>