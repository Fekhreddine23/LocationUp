<app-breadcrumbs [items]="breadcrumbItems"></app-breadcrumbs>


<div class="create-booking-container">
  <div class="booking-form-card">
    <h2>Nouvelle R√©servation</h2>

    <!-- Messages -->
    <div *ngIf="successMessage" class="alert alert-success">
      ‚úÖ {{ successMessage }}
      <p>Redirection automatique dans 2 secondes...</p>
    </div>

    <div *ngIf="errorMessage" class="alert alert-error">
      ‚ùå {{ errorMessage }}
    </div>

    <!-- Chargement de l'offre -->
    <div *ngIf="isLoadingOffer" class="loading-offer">
      <div class="spinner"></div>
      <p>Chargement de l'offre s√©lectionn√©e...</p>
    </div>

    <form (ngSubmit)="onSubmit()" #bookingForm="ngForm" 
          *ngIf="!successMessage && !isLoadingOffer && selectedOffer">
      
      <!-- Offre pr√©s√©lectionn√©e (affichage seulement) -->
      <div class="selected-offer-section">
        <h3>üéØ Offre S√©lectionn√©e</h3>
        <div class="offer-card selected">
          <div class="offer-header">
            <h4>{{ selectedOffer.description }}</h4>
            <span class="price-tag">{{ selectedOffer.price | currency:'EUR' }}</span>
          </div>
          
          <div class="offer-details">
            <p class="pickup-time">
              <strong>üìÖ Disponible le:</strong> 
              {{ selectedOffer.pickupDatetime | date:'dd/MM/yyyy √† HH:mm' }}
            </p>
            <p class="offer-id">
              <strong>ID Offre:</strong> {{ selectedOffer.offerId }}
            </p>
          </div>

          <div class="offer-note">
            <small>‚úÖ Cette offre a √©t√© s√©lectionn√©e depuis le catalogue</small>
          </div>
        </div>
      </div>

      <!-- Date et heure de r√©servation -->
      <div class="form-group">
        <label for="reservationDate">Date et heure de r√©servation *</label>
        <input 
          type="datetime-local"
          id="reservationDate"
          name="reservationDate"
          [(ngModel)]="bookingRequest.reservationDate"
          required
          class="form-control"
          [disabled]="isLoading"
          [min]="getMinDate()"
          [max]="getMaxDate()">
        <small class="form-help">
          S√©lectionnez la date et l'heure souhait√©es pour votre r√©servation
        </small>
      </div>

      <!-- Informations de l'utilisateur -->
      <div class="form-group" *ngIf="bookingRequest.userId > 0">
        <label>Utilisateur</label>
        <div class="user-info">
          <strong>ID:</strong> {{ bookingRequest.userId }}
          <span *ngIf="currentUser">({{ currentUser.username }})</span>
        </div>
        <small class="form-help">Votre identifiant utilisateur</small>
      </div>

      <!-- Aper√ßu de la r√©servation -->
      <div *ngIf="bookingRequest.reservationDate" class="preview-section">
        <h4>üìã Aper√ßu de la r√©servation :</h4>
        <div class="preview-details final-preview">
          <div class="preview-item">
            <strong>Offre :</strong> {{ selectedOffer.description }}
          </div>
          <div class="preview-item">
            <strong>Prix :</strong> {{ selectedOffer.price | currency:'EUR' }}
          </div>
          <div class="preview-item">
            <strong>Date de r√©servation :</strong> {{ bookingRequest.reservationDate | date:'dd/MM/yyyy HH:mm' }}
          </div>
          <div class="preview-item">
            <strong>Utilisateur :</strong> ID {{ bookingRequest.userId }}
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="form-actions">
        <button 
          type="button" 
          class="btn btn-secondary"
          (click)="onCancel()"
          [disabled]="isLoading">
          Annuler
        </button>
        
        <button 
          type="submit" 
          class="btn btn-primary"
          [disabled]="!bookingForm.form.valid || isLoading">
          {{ isLoading ? '‚è≥ Cr√©ation en cours...' : '‚úÖ Confirmer la r√©servation' }}
        </button>
      </div>
    </form>

    <!-- Message si aucune offre -->
    <div *ngIf="!isLoadingOffer && !selectedOffer && !successMessage" class="no-offer-message">
      <div class="warning-icon">‚ö†Ô∏è</div>
      <h3>Aucune offre s√©lectionn√©e</h3>
      <p>Veuillez s√©lectionner une offre depuis le catalogue pour pouvoir r√©server.</p>
      <button class="btn btn-primary" (click)="onCancel()">
        üìã Voir les offres disponibles
      </button>
    </div>

    <div *ngIf="successMessage" class="success-actions">
      <button 
        type="button" 
        class="btn btn-primary"
        (click)="navigateToBookings()">
        üìã Voir mes r√©servations
      </button>
    </div>
  </div>
</div>